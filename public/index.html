<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EmotiKnow — Emma (Voice Companion)</title>
  <style>
    body {
      margin: 0;
      background: #0f1117;
      color: #e6e8ef;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }
    #container {
      position: relative;
      max-width: 900px;
    }
    #portrait {
      width: 100%;
      display: block;
    }
    #mouth {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      pointer-events: none;
    }
    #controls {
      margin-top: 10px;
      text-align: center;
    }
    input[type=range] {
      width: 200px;
    }
    button {
      margin: 5px;
      padding: 6px 14px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      background: #8ab4ff;
      color: black;
      font-weight: bold;
    }
    button:disabled {
      background: #555;
      color: #aaa;
    }
  </style>
</head>
<body>
  <h2>EmotiKnow — Emma (Voice Companion)</h2>
  <div id="container">
    <img id="portrait" src="/mouth/m.png" alt="portrait"/>
    <img id="mouth" src="" alt="mouth"/>
  </div>

  <div id="controls">
    <label>Target width 
      <input id="widthSlider" type="range" min="60" max="400" value="260"/>
    </label>
    <br/>
    <label>Scale % 
      <input id="scaleSlider" type="range" min="50" max="200" value="100"/>
    </label>
    <br/>
    <button id="startBtn">Start</button>
    <button id="stopBtn" disabled>Hang Up</button>
  </div>

  <script>
    const frames = ["f","g","i","l","m","o","p","u","say"];
    const mouthImgs = {};
    const mouth = document.getElementById("mouth");
    const portrait = document.getElementById("portrait");
    const widthSlider = document.getElementById("widthSlider");
    const scaleSlider = document.getElementById("scaleSlider");
    const startBtn = document.getElementById("startBtn");
    const stopBtn = document.getElementById("stopBtn");

    let idx = 0;
    let interval = null;

    // Preload images
    frames.forEach(f => {
      const img = new Image();
      img.src = `/mouth/${f}.png`;
      mouthImgs[f] = img;
    });

    function updateMouthFrame(f) {
      if (!mouthImgs[f]) return;
      let targetWidth = parseInt(widthSlider.value);
      let scale = parseInt(scaleSlider.value) / 100;

      mouth.src = mouthImgs[f].src;
      mouth.style.width = `${targetWidth}px`;
      mouth.style.transform = `translate(-50%, -50%) scale(${scale})`;

      // Always center relative to portrait
      mouth.style.left = "50%";
      mouth.style.top = "50%";
    }

    startBtn.onclick = () => {
      if (interval) return;
      interval = setInterval(() => {
        updateMouthFrame(frames[idx % frames.length]);
        idx++;
      }, 200); // every 200ms
      startBtn.disabled = true;
      stopBtn.disabled = false;
    };

    stopBtn.onclick = () => {
      clearInterval(interval);
      interval = null;
      startBtn.disabled = false;
      stopBtn.disabled = true;
    };
  </script>
</body>
</html>
